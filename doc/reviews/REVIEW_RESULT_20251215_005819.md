# MIDIã‚¨ãƒ‡ã‚£ã‚¿ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

**ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½æ—¥**: 2025-12-15
**ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡**: `/src` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“ã€ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ `35a3c91bc7341b2aa1b21a1bf9b86870f3d1fa9e`
**å‰å›ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡**: `ca57a5d2c082def003fdb92482078f2ac9090b8e` (2025-12-14)
**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ–¹é‡**: ã‚³ãƒ¼ãƒ‰ã®è¦‹é€šã—ã®è‰¯ã•ã€ã‚·ãƒ³ãƒ—ãƒ«ã•ã€æ‹¡å¼µå®¹æ˜“æ€§ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹/å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã®çµ±ä¸€æ„Ÿã‚’é‡è¦–

---

## ğŸ“‹ ç›®æ¬¡

1. [å‰å›ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰ã®æ”¹å–„çŠ¶æ³](#1-å‰å›ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰ã®æ”¹å–„çŠ¶æ³)
2. [æœ€æ–°ã‚³ãƒŸãƒƒãƒˆã®åˆ†æ](#2-æœ€æ–°ã‚³ãƒŸãƒƒãƒˆã®åˆ†æ)
3. [æ–°è¦ã«ç™ºè¦‹ã•ã‚ŒãŸèª²é¡Œ](#3-æ–°è¦ã«ç™ºè¦‹ã•ã‚ŒãŸèª²é¡Œ)
4. [ã‚³ãƒ¼ãƒ‰å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹](#4-ã‚³ãƒ¼ãƒ‰å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹)
5. [æ”¹å–„å„ªå…ˆåº¦](#5-æ”¹å–„å„ªå…ˆåº¦)
6. [ç·åˆè©•ä¾¡](#6-ç·åˆè©•ä¾¡)

---

## 1. å‰å›ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰ã®æ”¹å–„çŠ¶æ³

### âš ï¸ é‡å¤§: 5ã¤ã®æŒ‡æ‘˜äº‹é …ãŒå…¨ãæ”¹å–„ã•ã‚Œã¦ã„ãªã„

**å‰å›ã® REVIEW_RESULT_20251214_224110.md ã§æŒ‡æ‘˜ã•ã‚ŒãŸ 5 ã¤ã® CRITICAL/HIGH å„ªå…ˆåº¦ã®èª²é¡Œ:**

| # | èª²é¡Œ | çŠ¶æ…‹ | ãƒ•ã‚¡ã‚¤ãƒ« |
|----|------|------|---------|
| 1 | Set vs Update å‘½åã®ä¸çµ±ä¸€ | âŒ æœªè§£æ±º | models/Song.ts, models/Channel.ts, usecases/ |
| 2 | select/selectOnly å‘½åã®ä¸çµ±ä¸€ | âŒ æœªè§£æ±º | src/Editor/Editor.ts |
| 3 | å‹ã‚­ãƒ£ã‚¹ãƒˆ (as SoundFontInstrumentKey) | âŒ æœªè§£æ±º (ã‚€ã—ã‚å¢—åŠ ) | src/ToolBar/ToolBar.tsx |
| 4 | marqueeArea å‹ã®éå¯¾ç§°æ€§ | âŒ æœªè§£æ±º | src/Editor/ParameterEditor/, src/Editor/PianoRoll/ |
| 5 | EventBus listener cleanup | âŒ æœªè§£æ±º | src/InstrumentStore.ts, src/SongStore.ts |

**è©•ä¾¡**: âš ï¸ **å¾Œé€€** - å‰å›æŒ‡æ‘˜ã•ã‚ŒãŸä¸»è¦ãªè¨­è¨ˆèª²é¡ŒãŒæ”¾ç½®ã•ã‚ŒãŸã¾ã¾ã§ã™ã€‚

---

## 2. æœ€æ–°ã‚³ãƒŸãƒƒãƒˆã®åˆ†æ

### ã‚³ãƒŸãƒƒãƒˆ: "Improve SoundFont to preview global zone generator appropriately"

**å¤‰æ›´å†…å®¹**: SoundFont æ¥½å™¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¾ãƒ¼ãƒ³ç”Ÿæˆæ©Ÿèƒ½ã®æ”¹å–„

**æ–°è¦è¿½åŠ ãƒ•ã‚¡ã‚¤ãƒ«** (8 ãƒ•ã‚¡ã‚¤ãƒ«):
- `src/SoundFont/Instrument.ts` - æ¥½å™¨ã‚¾ãƒ¼ãƒ³ç®¡ç†
- `src/SoundFont/InstrumentZone.ts` - ã‚¾ãƒ¼ãƒ³å‹å®šç¾©
- `src/SoundFont/Preset.ts` - ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†
- `src/SoundFont/PresetZone.ts` - ãƒ—ãƒªã‚»ãƒƒãƒˆã‚¾ãƒ¼ãƒ³
- `src/SoundFont/Range.ts` - ç¯„å›²ç®¡ç†
- `src/SoundFont/Sample.ts` - ã‚µãƒ³ãƒ—ãƒ«ç®¡ç†
- `src/SoundFont/Zone.ts` - ã‚¾ãƒ¼ãƒ³åŸºæœ¬å‹
- `src/SoundFont/sf2.ts` - SoundFont 2.0 å½¢å¼å®šç¾©

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«** (5 ãƒ•ã‚¡ã‚¤ãƒ«):
- `src/SoundFont/SoundFont.ts` - ãƒ—ãƒªã‚»ãƒƒãƒˆå–å¾—ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„
- `src/SoundFontInstrument.ts` - æ¥½å™¨ã‚¯ãƒ©ã‚¹æ”¹å–„
- `src/ToolBar/BankSelect.tsx` - UI æ›´æ–°
- `src/ToolBar/PresetSelect.tsx` - UI æ›´æ–°

### ãƒã‚¸ãƒ†ã‚£ãƒ–ãªå´é¢

âœ… **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä¸€è²«æ€§**:
- æ–°ã—ã„ SoundFont å‹ã¯ immutable ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’éµå®ˆ
- `create()` ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¡ã‚½ãƒƒãƒ‰ã§ç”Ÿæˆ
- `getter` ãƒ¡ã‚½ãƒƒãƒ‰ã§æ¡ä»¶ä»˜ãé¸æŠ

âœ… **è²¬å‹™ã®åˆ†é›¢**:
- æ¥½å™¨ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã€ã‚¾ãƒ¼ãƒ³ã€ç¯„å›²ãªã©ãŒé©åˆ‡ã«åˆ†é›¢
- å„ã‚¯ãƒ©ã‚¹ãŒå˜ä¸€è²¬ä»»ã‚’æŒã¤

âœ… **å‹å®‰å…¨æ€§**:
- `InstrumentZone`, `Range` ãªã©æ–°ã—ã„å‹ã§å¼·ã„å‹ä»˜ã‘
- API ãŒæ˜ç¢ºã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹

---

## 3. æ–°è¦ã«ç™ºè¦‹ã•ã‚ŒãŸèª²é¡Œ

### 3.1 ğŸ”´ CRITICAL: SoundFontInstrument.ts ã® ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ typo

**å•é¡Œåº¦**: éå¸¸ã«é«˜ - **ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒã‚°**

**Location**: `src/SoundFontInstrument.ts` (L34-51)

**ç™ºè¦‹ã•ã‚ŒãŸãƒã‚°**:

```typescript
// Line 34-41: serialize() ãƒ¡ã‚½ãƒƒãƒ‰
serialize(): SerializedSoundFontInstrumentKey {
    return {
        type: "sf",
        url: this.url,
        presetNumber: this.presetNumber,
        bunkNumber: this.bankNumber,  // âŒ typo: "bunk" instead of "bank"
    };
}

// Line 43-51: deserialize() ãƒ¡ã‚½ãƒƒãƒ‰
static deserialize(data: SerializedSoundFontInstrumentKey): SoundFontInstrumentKey {
    return new SoundFontInstrumentKey(
        data.url,
        data.presetNumber,
        data.bunkNumber,  // âŒ typo: "bunk" instead of "bank"
    );
}

// Line 54-59: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
export interface SerializedSoundFontInstrumentKey {
    type: "sf";
    url: string;
    presetNumber: number;
    bunkNumber: number;  // âŒ typo: "bunk" instead of "bank"
}
```

**å®Ÿéš›ã®å‹•ä½œã¨ã®çŸ›ç›¾**:

```typescript
// ã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨å®Ÿè£…ã§ã¯ "bankNumber" ã‚’ä½¿ç”¨
constructor(
    public readonly url: string,
    public readonly presetNumber: number,
    public readonly bankNumber: number,  // âœ… æ­£ã—ã„åå‰
) {}

hash(): Hash {
    return `${this.url}::${this.presetNumber}::${this.bankNumber}`;  // âœ…
}
```

**å½±éŸ¿**:

1. **ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜æ™‚ã® ãƒ‡ãƒ¼ã‚¿æå¤±**: SoundFont ã®ãƒãƒ³ã‚¯æƒ…å ±ãŒã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã•ã‚Œã‚‹ã¨ `bunkNumber` ã¨ã—ã¦ä¿å­˜ã•ã‚Œã‚‹
2. **ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æ™‚ã® ã‚¨ãƒ©ãƒ¼**: ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºæ™‚ã« `data.bunkNumber` ã‚’èª­ã¿å‡ºãã†ã¨ã™ã‚‹ãŒã€å®Ÿã¯ property ã¯ `bankNumber`
3. **å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ã®ãƒªã‚¹ã‚¯**: `undefined` ãŒæ¸¡ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

**ä¿®æ­£æ¡ˆ**:
```typescript
// æ­£ã—ã„å®Ÿè£…
serialize(): SerializedSoundFontInstrumentKey {
    return {
        type: "sf",
        url: this.url,
        presetNumber: this.presetNumber,
        bankNumber: this.bankNumber,  // âœ… "bank" ã«çµ±ä¸€
    };
}

export interface SerializedSoundFontInstrumentKey {
    type: "sf";
    url: string;
    presetNumber: number;
    bankNumber: number;  // âœ… "bank" ã«çµ±ä¸€
}
```

**å„ªå…ˆåº¦**: ğŸ”´ **CRITICAL** - å³åº§ã«ä¿®æ­£ãŒå¿…è¦

---

### 3.2 ğŸŸ¡ MEDIUM: SoundFont æ©Ÿèƒ½è¿½åŠ ã«ä¼´ã†å‹ã‚­ãƒ£ã‚¹ãƒˆå¢—åŠ 

**Location**: `src/ToolBar/ToolBar.tsx`

**å•é¡Œ**:

å‰å›ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æŒ‡æ‘˜ã•ã‚ŒãŸ `as SoundFontInstrumentKey` ã‚­ãƒ£ã‚¹ãƒˆãŒæ¸›å°‘ã—ã¦ã„ã¾ã›ã‚“ã€‚å®Ÿã¯åŒã˜ãƒ¬ãƒ™ãƒ«ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™:

```typescript
// Line 53
const instrumentKey = activeChannel.instrumentKey as SoundFontInstrumentKey;

// Line 89
(activeChannel.instrumentKey as SoundFontInstrumentKey).presetNumber

// Line 94
(activeChannel.instrumentKey as SoundFontInstrumentKey).url,

// Line 106
(activeChannel.instrumentKey as SoundFontInstrumentKey).presetNumber

// Line 112-114
(activeChannel.instrumentKey as SoundFontInstrumentKey).url,
(activeChannel.instrumentKey as SoundFontInstrumentKey).presetNumber,
```

**æ”¹å–„ã•ã‚Œã‚‹ã¹ãçŠ¶æ³**:

```typescript
// æ¨å¥¨: å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°ã‚’å°å…¥
function isSoundFontInstrumentKey(key: InstrumentKey): key is SoundFontInstrumentKey {
    return "url" in key && "bankNumber" in key && "presetNumber" in key;
}

// ä½¿ç”¨ä¾‹
if (activeChannel === null) return null;
if (!isSoundFontInstrumentKey(activeChannel.instrumentKey)) return null;

const soundFont = soundFontStoreState.get(activeChannel.instrumentKey.url);
```

**å„ªå…ˆåº¦**: ğŸŸ¡ **HIGH** - å‹å®‰å…¨æ€§å‘ä¸Š

---

### 3.3 ğŸŸ¡ MEDIUM: SoundFont é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆ

**Location**: `src/SoundFont/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“

**ãƒã‚¸ãƒ†ã‚£ãƒ–ãªè¦³å¯Ÿ**:

âœ… æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸ SoundFont ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯è‰¯å¥½ãªè¨­è¨ˆã§ã™:

```typescript
// Instrument.ts - ã‚¾ãƒ¼ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
export class Instrument {
    getZones(key: number, velocity: number): InstrumentZone[] {
        const zones: InstrumentZone[] = [];
        for (const zone of this.zones) {
            if (!zone.keyRange.includes(key)) continue;      // å‹å®‰å…¨
            if (!zone.velocityRange.includes(velocity)) continue;
            if (zone.sample === null) continue;
            zones.push(zone);
        }
        return zones;
    }
}
```

âœ… `Range.ts` æŠ½è±¡åŒ–:
- `keyRange`, `velocityRange` ãŒ Range ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¡¨ç¾
- `includes()` ãƒ¡ã‚½ãƒƒãƒ‰ã§ç¯„å›²åˆ¤å®šãŒçµ±ä¸€
- DRY åŸå‰‡ã‚’éµå®ˆ

**èª²é¡Œãªã—** - ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ååˆ†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

---

### 3.4 ğŸŸ¢ LOW: useStateful ãƒ•ãƒƒã‚¯ã®æ´»ç”¨

**Location**: è¤‡æ•°ã® React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**è¦³å¯Ÿ**:

æ–°è¦ã«è¿½åŠ ã•ã‚ŒãŸ `BankSelect.tsx`, `PresetSelect.tsx` ãªã© SoundFont é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ useStateful ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ­£ã—ãä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

**è©•ä¾¡**: âœ… è‰¯å¥½ - çµ±ä¸€æ€§ãŒä¿ãŸã‚Œã¦ã„ã‚‹

---

## 4. ã‚³ãƒ¼ãƒ‰å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹

### å‰å›ã‹ã‚‰ã®å¤‰åŒ–

| æŒ‡æ¨™ | å‰å› | ä»Šå› | å¤‰åŒ– |
|------|------|------|------|
| ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ | 9/10 | 9/10 | â¡ï¸ å¤‰åŒ–ãªã— |
| å‹å®‰å…¨æ€§ | 7/10 | 6/10 | ğŸ“‰ ä½ä¸‹ (æ–°è¦ã® typo, ã‚­ãƒ£ã‚¹ãƒˆã¯ãã®ã¾ã¾) |
| å‘½åã®ä¸€è²«æ€§ | 6/10 | 6/10 | â¡ï¸ æ”¹å–„ãªã— |
| é–¢å¿ƒã®åˆ†é›¢ | 9/10 | 9/10 | â¡ï¸ æ–°è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å“è³ªãŒé«˜ã„ |
| ä¿å®ˆæ€§ | 8/10 | 8/10 | â¡ï¸ å¤‰åŒ–ãªã— |
| **ç·åˆã‚¹ã‚³ã‚¢** | **8/10** | **7.5/10** | ğŸ“‰ **ä½ä¸‹** |

**ä½ä¸‹ã®ç†ç”±**:
1. æ–°è¦è¿½åŠ ãƒ•ã‚¡ã‚¤ãƒ«ã«è‡´å‘½çš„ãª typo ãŒå«ã¾ã‚Œã¦ã„ã‚‹
2. å‰å›æŒ‡æ‘˜ã® 5 ã¤ã®ä¸»è¦èª²é¡ŒãŒå…¨ãæ”¹å–„ã•ã‚Œã¦ã„ãªã„
3. å‹ã‚­ãƒ£ã‚¹ãƒˆå•é¡ŒãŒæ”¾ç½®ã•ã‚ŒãŸã¾ã¾

---

## 5. æ”¹å–„å„ªå…ˆåº¦

### ğŸ”´ CRITICAL (å³åº§ã«å¯¾å¿œ - ä»Šæ—¥ä¸­)

| # | é …ç›® | ç†ç”± | æ¨å®šå·¥æ•° | ãƒ•ã‚¡ã‚¤ãƒ« |
|----|------|------|---------|---------|
| 1 | bunkNumber â†’ bankNumber typo ä¿®æ­£ | ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒã‚° | 15åˆ† | src/SoundFontInstrument.ts |
| 2 | Set vs Update å‘½åè¦ç´„çµ±ä¸€ | API ç†è§£å›°é›£ | 2-3h | models/, usecases/ |

---

### ğŸŸ¡ HIGH (æ¬¡ã‚¹ãƒ—ãƒªãƒ³ãƒˆ - 1-2æ—¥ä»¥å†…)

| # | é …ç›® | ç†ç”± | æ¨å®šå·¥æ•° | ãƒ•ã‚¡ã‚¤ãƒ« |
|----|------|------|---------|---------|
| 3 | select/selectOnly å‘½åçµ±ä¸€ | ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æ˜ç¢ºåŒ– | 1-2h | src/Editor/ |
| 4 | å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°å°å…¥ | å‹å®‰å…¨æ€§å‘ä¸Š | 1h | src/ToolBar/, src/InstrumentDialog/ |
| 5 | marqueeArea å‹çµ±ä¸€ | ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµ±ä¸€ | 1h | src/Editor/ |
| 6 | EventBus listener cleanup | ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ | 1h | src/*Store.ts |

---

### ğŸŸ¢ MEDIUM (å°†æ¥çš„ãªæ”¹å–„)

| # | é …ç›® | ç†ç”± | æ¨å®šå·¥æ•° | ãƒ•ã‚¡ã‚¤ãƒ« |
|----|------|------|---------|---------|
| 7 | PianoRoll è²¬å‹™åˆ†é›¢ | å˜ä¸€è²¬ä»»åŸå‰‡ | 4-6h | src/Editor/PianoRoll/ |

---

## 6. ç·åˆè©•ä¾¡

### ğŸ“Š ã‚¹ã‚³ã‚¢å†…è¨³

| æŒ‡æ¨™ | ã‚¹ã‚³ã‚¢ | ã‚³ãƒ¡ãƒ³ãƒˆ |
|------|--------|---------|
| ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ | 9/10 | å±¤æ§‹é€ ãŒæ˜ç¢ºã§å®‰å®šã—ã¦ã„ã‚‹ |
| æ–°è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å“è³ª | 9/10 | SoundFont ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆã¯è‰¯å¥½ |
| å‹å®‰å…¨æ€§ | 6/10 | æ–°è¦ typo ã¨æœªè§£æ±ºã®ã‚­ãƒ£ã‚¹ãƒˆå•é¡Œ âš ï¸ |
| å‘½åã®ä¸€è²«æ€§ | 6/10 | set/update, select/selectOnly ãŒæ··åœ¨ âš ï¸ |
| ã‚³ãƒ¼ãƒ‰ä¿å®ˆæ€§ | 8/10 | ç·ä½“çš„ã«ã¯è‰¯å¥½ã€èª²é¡Œã¯é™å®šçš„ |
| **ç·åˆã‚¹ã‚³ã‚¢** | **7.5/10** | å‰å›ã‹ã‚‰ä½ä¸‹ (æ–°è¦ãƒã‚°æ¤œå‡º) |

---

### å¼·ã¿ âœ…

1. **æ–°è¦ SoundFont ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­è¨ˆå“è³ª** - è²¬å‹™ãŒæ˜ç¢ºã«åˆ†é›¢
2. **å±¤æ§‹é€ ã®å®‰å®šæ€§** - Model â†’ UseCase â†’ Presentation ãŒæ˜ç¢º
3. **Immutable ãƒ‘ã‚¿ãƒ¼ãƒ³** - State ç®¡ç†ãŒå®‰å…¨
4. **DI ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€è²«æ€§** - ä¾å­˜æ€§ç®¡ç†ãŒé€æ˜
5. **React çµ±åˆ** - useStateful ãƒ•ãƒƒã‚¯ãŒæ­£ã—ãä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹

---

### èª²é¡Œ âš ï¸

1. **ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒã‚°** ğŸ”´ - `bunkNumber` typo ã¯å³åº§ã«ä¿®æ­£ãŒå¿…è¦
2. **å‘½åã®ä¸çµ±ä¸€** - set/update, select/selectOnly ãŒæ··åœ¨
3. **å‹ã‚­ãƒ£ã‚¹ãƒˆã®ä¹±ç”¨** - as SoundFontInstrumentKey ãŒ 7+ ç®‡æ‰€
4. **å‰å›æŒ‡æ‘˜ã®æ”¾ç½®** - 5 ã¤ã®ä¸»è¦èª²é¡ŒãŒæ”¹å–„ã•ã‚Œã¦ã„ãªã„
5. **EventBus listener cleanup** - ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ã®è€ƒæ…®ãŒä¸è¶³

---

## æ”¹å–„ã¸ã®æ¨å¥¨ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: ç·Šæ€¥å¯¾å¿œ (ä»Šæ—¥)

**ç›®æ¨™**: æœ¬ç•ªç’°å¢ƒã§ã®éšœå®³ã‚’é˜²ã

1. **SoundFontInstrument.ts ã® typo ä¿®æ­£**
   - `bunkNumber` â†’ `bankNumber` ã«çµ±ä¸€
   - ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³/ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½
   - ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª

2. **å‹ãƒ†ã‚¹ãƒˆã®å¼·åŒ–**
   - SoundFont æ©Ÿèƒ½ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜/èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½

---

### Phase 2: è¨­è¨ˆæ”¹å–„ (1-2 æ—¥ä»¥å†…)

**ç›®æ¨™**: API ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æ˜ç¢ºåŒ–

1. **Set vs Update å‘½åè¦ç´„ã®çµ±ä¸€**
   - `set*()` â†’ å…¨ç½®æ›æ“ä½œ
   - `update*()` ã¾ãŸã¯ `patch*()` â†’ éƒ¨åˆ†æ›´æ–°æ“ä½œ
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–

2. **Select é–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰ã®åå‰çµ±ä¸€**
   ```typescript
   // Option A: ç½®æ›ç³»ã¨è¿½åŠ /å‰Šé™¤ç³»ã‚’æ˜ç¤º
   replaceSelectedNotes(noteIds)   // å…¨ç½®æ›
   addSelectedNotes(noteIds)       // è¿½åŠ 
   removeSelectedNotes(noteIds)    // å‰Šé™¤
   clearSelectedNotes()            // å…¨å‰Šé™¤
   ```

3. **å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°ã®å°å…¥**
   ```typescript
   function isSoundFontInstrumentKey(key): key is SoundFontInstrumentKey {
       return "url" in key && "bankNumber" in key;
   }
   ```

---

### Phase 3: æ§‹é€ æ”¹å–„ (å°†æ¥çš„)

**ç›®æ¨™**: ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã¨ä¿å®ˆæ€§å‘ä¸Š

1. **PianoRoll ã®è²¬å‹™åˆ†é›¢**
   - ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å±¤ã®åˆ†é›¢
   - é¸æŠãƒ­ã‚¸ãƒƒã‚¯ã®æŠ½å‡º
   - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã®åˆ†é›¢

2. **EventBus listener ç®¡ç†ã®ä¸€å…ƒåŒ–**
   - Store ã« `dispose()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
   - ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ã‚’æ˜ç¤ºçš„ã«

---

## å‚™è€ƒ

### é–‹ç™ºé€Ÿåº¦ã¨å“è³ªã®ãƒãƒ©ãƒ³ã‚¹

ã“ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æ¤œå‡ºã•ã‚ŒãŸ `bunkNumber` typo ã¯ã€æ–°è¦æ©Ÿèƒ½ã®å®Ÿè£…é€Ÿåº¦ã‚’é‡è¦–ã—ãŸçµæœã¨ã—ã¦ç†è§£ã§ãã¾ã™ã€‚ã—ã‹ã—ä»¥ä¸‹ã®ç‚¹ãŒæ‡¸å¿µã•ã‚Œã¾ã™:

1. **å‰å›æŒ‡æ‘˜ã® 5 ã¤ã®èª²é¡ŒãŒæ”¹å–„ã•ã‚Œã¦ã„ãªã„** - æŠ€è¡“è² å‚µãŒç´¯ç©ã—ã¦ã„ã‚‹
2. **ãƒ†ã‚¹ãƒˆãŒæ˜ç¤ºçš„ã«æ›¸ã‹ã‚Œã¦ã„ãªã„** - ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã«é–¢ã™ã‚‹ãƒã‚°ã‚’ã‚­ãƒ£ãƒƒãƒã§ããªã‹ã£ãŸ
3. **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸åœ¨** - typo ãŒæœ¬ç•ªå‰ã«æ¤œå‡ºã•ã‚Œãªã‹ã£ãŸ

**æ¨å¥¨**: æ¬¡å›ã‹ã‚‰ã¯ä»¥ä¸‹ã‚’æ¤œè¨ã—ã¦ãã ã•ã„:
- ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®å¤‰æ›´æ™‚ã¯è‡ªå‹•ãƒ†ã‚¹ãƒˆ
- ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³/ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

---

## æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¸ã®æŒ‡æ¨™

æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼ (2025-12-16 ä»¥é™) ã§ã¯ä»¥ä¸‹ã‚’ç¢ºèªã—ãŸã„ã¨è€ƒãˆã¾ã™:

- [ ] bunkNumber typo ãŒä¿®æ­£ã•ã‚ŒãŸã‹
- [ ] Set vs Update å‘½åãŒçµ±ä¸€ã•ã‚ŒãŸã‹
- [ ] select/selectOnly ãƒ¡ã‚½ãƒƒãƒ‰åãŒæ”¹å–„ã•ã‚ŒãŸã‹
- [ ] å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°ãŒå°å…¥ã•ã‚ŒãŸã‹
- [ ] EventBus listener cleanup ãŒå®Ÿè£…ã•ã‚ŒãŸã‹

---

## çµè«–

**ç·åˆã‚¹ã‚³ã‚¢**: 7.5/10 (å‰å› 8/10 ã‹ã‚‰ä½ä¸‹)

**è©•ä¾¡**:
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åŸºç›¤ã¯å …å®Ÿ
- æ–°è¦ SoundFont ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­è¨ˆå“è³ªã¯é«˜ã„
- ã—ã‹ã—æ–°è¦ãƒã‚° (typo) ã¨å‰å›æŒ‡æ‘˜ã®æ”¾ç½®ãŒæ‡¸å¿µã•ã‚Œã‚‹

**æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
1. **å³åº§**: `bunkNumber` typo ã‚’ä¿®æ­£ã—ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½
2. **çŸ­æœŸ**: å‘½åè¦ç´„ã‚’çµ±ä¸€ã—ã€API ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æ˜ç¢ºåŒ–
3. **ä¸­æœŸ**: å‹å®‰å…¨æ€§ã‚’å¼·åŒ–ã—ã€ãƒ¡ãƒ¢ãƒªç®¡ç†ã‚’æ”¹å–„

**å…¨ä½“çš„ãªæ–¹å‘æ€§**: âš ï¸ **æ³¨æ„** - æ–°è¦æ©Ÿèƒ½ã®è¿½åŠ ã¨æ—¢å­˜èª²é¡Œã®æ”¹å–„ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

---

**ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†æ—¥**: 2025-12-15
**ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½è€…**: Claude Code
**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 100+ TypeScript ãƒ•ã‚¡ã‚¤ãƒ«
**ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ~12,000 è¡Œ (æ¨å®š)
**æ¯”è¼ƒå¯¾è±¡**: REVIEW_RESULT_20251214_224110.md (å‰å›ãƒ¬ãƒ“ãƒ¥ãƒ¼)
